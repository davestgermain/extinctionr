{% extends "base.html" %}

{% block content %}
{% load info %}
<div class="row pt-4 text-center">
	<div class="col-lg-10 col-sm-12 offset-lg-1">
		<h1>{{action.name}}</h1>
		<h2>{{action.when}}</h2>
		{% if action.location %}
		<P class="text-info"><a href="https://maps.google.com/?q={{action.location|urlencode}}">{{action.location|linebreaks}}</a></P>
		{% endif %}
		<div class="text-left">{{action.description|markdownify}}</div>
		<hr>
	</div>
</div>
{% if action.photos.exists %}
{% load thumbnail %}
<section class="row photo-view">
	{% for photo in action.photos.all %}
	<div class="col-4">
      {% thumbnail photo.photo "400x400" as im %}
      <a href="{{photo.photo.url}}"><img class="img img-fluid" src="{{ im.url }}" alt="{{photo.caption}}"></a>
      {% endthumbnail %}
	</div>
{% if forloop.counter|divisibleby:3 %}</section><section class="row mt-2">{% endif %}
	{% endfor %}
</section>
<hr>
{% endif %}
{% if form %}
<div class="row mt-4">
	<div class="col-lg-6 col-sm-12 offset-sm-0 offset-lg-3">
		<form method="post"> {% csrf_token %}
			<div class="text-danger">{{form.non_field_errors}}</div>
			<div class="form-group row">
				<label for="{{form.email.id_for_label}}" class="col-4 text-right">Email:</label>
				<div class="col-auto">
					{{form.email}}
					<div class="text-danger">{{form.email.errors}}</div>
				</div>
			</div>
			<div class="form-group row">
				<label for="{{form.name.id_for_label}}" class="col-4 text-right">Your Name:</label>
				<div class="col-auto">
					{{form.name}}
					<div class="text-danger">{{form.name.errors}}</div>
				</div>
			</div>
			{% if form.fields.role.queryset %}
			<div class="form-group row">
				<label for="{{form.role.id_for_label}}" class="col-4 text-right">Your Role:</label>
				<div class="col-auto">
					{{form.role}}
					<div class="text-danger">{{form.role.errors}}</div>
				</div>
			</div>
			{% endif %}
			<div class="form-group row">
				<label for="{{form.promised.id_for_label}}" class="col-4 text-right form-check-label">I'm Committed!</label>
				<div class="col-auto">
					{{form.promised}}
					<div class="text-danger">{{form.promised.errors}}</div>
				</div>
			</div>
			<div class="form-group row">
				<label for="{{form.commit.id_for_label}}" class="col-4 text-right">I promise to attend if this many also commit:</label>
				<div class="col-2">
					{{form.commit}}
					<div class="text-danger">{{form.commit.errors}}</div>
				</div>
			</div>

			<div class="form-group row mt-4">
				<div class="col text-center">
					<input class="btn btn-lg btn-outline-dark btn-success text-uppercase" type="submit" value="I'm Going!">
				</div>
			</div>
		</form>
	</div>
</div>
{% endif %}
{% if request.user.is_staff %}
<div class="row mt-4">
	<div class="col">
		{% if 'actions.change_action' in perms %}<p class=""><a href="/admin/actions/action/{{action.id}}/change/">Edit</a></p>{% endif %}
		{% if attendees %}
		<table class="table table-striped">
			<thead class="thead-dark">
				<tr class="text-center">
				<th scope="col">#</th>
				<th scope="col">Name</th>
				<th scope="col">Email</th>
				<th scope="col">Phone</th>
				<th scope="col">Role</th>
				<th scope="col">Notes</th>
				</tr>
			</thead>
			<tbody class="small">
			{% for attendee in attendees %}
			<tr>
				<th scope="row"><a title="edit attendee" href="/admin/actions/attendee/{{attendee.id}}/change/">{{forloop.counter}}</a></th>
				<td><a title="edit contact" href="{% url 'contacts:view_contact' pk=attendee.contact_id %}">{{attendee.contact.first_name}} {{attendee.contact.last_name}}</a></td>
				<td>{% if attendee.contact.email %}<a href="mailto:{{attendee.contact.email}}">{{attendee.contact.email}}</a>{% endif %}</td>
				<td>{% if attendee.contact.phone %}{{attendee.contact.phone}}{% endif %}</td>
				<td>{{attendee.role}}</td>
				<td>{{attendee.notes}}</td>
			</tr>
			{% endfor %}
			</tbody>
		</table>
		{% endif %}
	</div>
</div>
{% endif %}

{% endblock %}
